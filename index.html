<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Automated Employee System</title>
    <meta name="description" content="Contact us for any inquiries about our automated employee system. Email us at contactmashab@gmail.com.">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Poppins -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- jsPDF for Resume Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f7f8fb;
        }
        .hidden {
            display: none;
        }
        .page {
            display: none;
        }
        .page.active {
            display: block;
        }
        #app-container.hidden {
            display: none;
        }
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            z-index: 999;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            z-index: 1000;
            max-height: 90vh;
            overflow-y: auto;
            background: white;
            border-radius: 0.75rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        /* Custom scrollbar for modal */
        .modal-content::-webkit-scrollbar {
            width: 8px;
        }
        .modal-content::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        .modal-content::-webkit-scrollbar-thumb {
            background: #a8a8a8;
            border-radius: 10px;
        }
        .modal-content::-webkit-scrollbar-thumb:hover {
            background: #888;
        }
        /* Spinner */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #007bff; /* Theme color */
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Edukate Theme Styles */
        .theme-btn {
            background-color: #007bff;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 500;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 123, 255, 0.2);
        }
        .theme-btn:hover {
            background-color: #0056b3;
            box-shadow: 0 6px 20px rgba(0, 123, 255, 0.3);
        }
        .theme-btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        .theme-btn-secondary:hover {
            background-color: #5a6268;
        }
        .theme-input {
            border: 1px solid #ced4da;
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        .theme-input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.15);
        }
        .theme-card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.07);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .theme-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.1);
        }
        .theme-text-primary {
            color: #007bff;
        }
        .theme-text-secondary {
            color: #6c757d;
        }
    </style>
</head>
<body class="text-gray-700">

    <!-- This container holds the main app. It will be hidden during redirects. -->
    <div id="app-container">
        <!-- Navbar -->
        <nav class="bg-white shadow-md sticky top-0 z-50">
            <div class="container mx-auto px-6 py-4 flex justify-between items-center">
                <a href="#" class="text-3xl font-bold theme-text-primary">AutoSystem</a>
                <div class="hidden md:flex space-x-8 items-center" id="nav-links">
                    <!-- Logged out links -->
                    <a href="#" class="nav-link text-gray-600 hover:theme-text-primary font-medium" data-page="signin">Sign In</a>
                    <a href="#" class="nav-link theme-btn" data-page="signup">Sign Up</a>
                    <!-- Logged in links -->
                    <a href="#" class="nav-link text-gray-600 hover:theme-text-primary font-medium hidden" data-page="main">Main</a>
                    <a href="#" class="nav-link text-gray-600 hover:theme-text-primary font-medium hidden" data-page="dashboard">Dashboard</a>
                    <a href="#" class="nav-link text-gray-600 hover:theme-text-primary font-medium hidden" data-page="profile">Profile</a>
                    <div class="relative">
                        <button id="notification-bell" class="hidden text-gray-500 hover:theme-text-primary focus:outline-none">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341A6.002 6.002 0 006 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path></svg>
                            <span id="notification-dot" class="hidden absolute top-0 right-0 block h-2 w-2 rounded-full bg-red-500 ring-2 ring-white"></span>
                        </button>
                        <div id="notification-dropdown" class="hidden absolute right-0 mt-2 w-80 bg-white rounded-md shadow-lg z-20">
                           <div class="py-2 px-4 font-bold border-b">Notifications</div>
                           <div id="notification-list" class="py-1 max-h-64 overflow-y-auto">
                               <!-- Notifications will be populated here -->
                           </div>
                        </div>
                    </div>
                    <button id="logout-btn" class="hidden theme-btn theme-btn-secondary">Logout</button>
                </div>
                <div class="md:hidden">
                    <button id="mobile-menu-button" class="text-gray-600 focus:outline-none">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                    </button>
                </div>
            </div>
            <!-- Mobile Menu -->
            <div id="mobile-menu" class="hidden md:hidden px-6 pt-2 pb-4 space-y-2 bg-white">
                <!-- Logged out links -->
                <a href="#" class="block nav-link text-gray-600 hover:theme-text-primary py-2" data-page="signin">Sign In</a>
                <a href="#" class="block nav-link text-gray-600 hover:theme-text-primary py-2" data-page="signup">Sign Up</a>
                <!-- Logged in links -->
                <a href="#" class="block nav-link text-gray-600 hover:theme-text-primary py-2 hidden" data-page="main">Main</a>
                <a href="#" class="block nav-link text-gray-600 hover:theme-text-primary py-2 hidden" data-page="dashboard">Dashboard</a>
                <a href="#" class="block nav-link text-gray-600 hover:theme-text-primary py-2 hidden" data-page="profile">Profile</a>
                <button id="mobile-logout-btn" class="w-full text-left block theme-btn theme-btn-secondary mt-2 hidden">Logout</button>
            </div>
        </nav>

        <main class="container mx-auto px-6 py-12">

            <!-- Sign In Page -->
            <div id="signin-page" class="page active">
                <div class="max-w-md mx-auto theme-card p-8 md:p-10">
                    <h2 class="text-3xl font-bold mb-6 text-center theme-text-primary">Sign In</h2>
                    <form id="signin-form" class="space-y-6">
                        <div>
                            <label for="signin-email" class="block text-gray-700 mb-2 font-medium">Email</label>
                            <input type="email" id="signin-email" class="w-full theme-input" required>
                        </div>
                        <div>
                            <label for="signin-password" class="block text-gray-700 mb-2 font-medium">Password</label>
                            <input type="password" id="signin-password" class="w-full theme-input" required>
                        </div>
                        <button type="submit" class="w-full theme-btn flex justify-center items-center">
                            <span class="btn-text">Sign In</span>
                        </button>
                    </form>
                    <div class="text-center mt-4">
                        <a href="#" id="forgot-password-link" class="text-sm theme-text-primary hover:underline">Forgot Password?</a>
                    </div>
                    <p class="text-center mt-4">Don't have an account? <a href="#" class="theme-text-primary hover:underline font-semibold nav-link" data-page="signup">Sign Up</a></p>
                    <div id="signin-error" class="text-red-500 mt-4 text-center"></div>
                </div>
            </div>

            <!-- Sign Up Page -->
            <div id="signup-page" class="page">
                <div class="max-w-md mx-auto theme-card p-8 md:p-10">
                    <h2 class="text-3xl font-bold mb-6 text-center theme-text-primary">Create Your ID</h2>
                    <form id="signup-form" class="space-y-6">
                        <div>
                            <label for="signup-name" class="block text-gray-700 mb-2 font-medium">Full Name</label>
                            <input type="text" id="signup-name" class="w-full theme-input" required>
                        </div>
                        <div>
                            <label for="signup-email" class="block text-gray-700 mb-2 font-medium">Email</label>
                            <input type="email" id="signup-email" class="w-full theme-input" required>
                        </div>
                        <div>
                            <label for="signup-password" class="block text-gray-700 mb-2 font-medium">Password</label>
                            <input type="password" id="signup-password" class="w-full theme-input" required>
                        </div>
                        <button type="submit" class="w-full theme-btn flex justify-center items-center">
                             <span class="btn-text">Sign Up</span>
                        </button>
                    </form>
                    <p class="text-center mt-4">Already have an account? <a href="#" class="theme-text-primary hover:underline font-semibold nav-link" data-page="signin">Sign In</a></p>
                    <div id="signup-error" class="text-red-500 mt-4 text-center"></div>
                </div>
            </div>

            <!-- Main Page -->
            <div id="main-page" class="page">
                <!-- Attendance Section -->
                <div class="theme-card p-8 mb-8">
                    <h2 class="text-2xl font-bold mb-4">Daily Attendance</h2>
                    <form id="attendance-form">
                        <div class="mb-4">
                            <label for="attendance-link" class="block text-gray-700 mb-2">Add Work Link for Today</label>
                            <input type="url" id="attendance-link" class="w-full theme-input" placeholder="https://example.com/work-proof" required>
                        </div>
                        <button type="submit" id="mark-attendance-btn" class="w-full theme-btn bg-green-500 hover:bg-green-600">Mark Attendance</button>
                    </form>
                    <div id="attendance-status" class="mt-4 text-center font-semibold"></div>
                </div>

                <h1 class="text-4xl font-bold mb-4">Your Short Links</h1>
                <p class="text-lg text-gray-600 mb-8">Share these links to track clicks and earn rewards.</p>
                <div id="short-links-container" class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <!-- Loading state -->
                    <div class="col-span-full text-center p-8">
                        <div class="spinner mx-auto"></div>
                        <p class="mt-4 text-gray-600">Loading your links...</p>
                    </div>
                </div>
            </div>

            <!-- Dashboard Page -->
            <div id="dashboard-page" class="page">
                <h1 class="text-4xl font-bold mb-8">Dashboard</h1>
                <div class="theme-card p-8 mb-8 text-center">
                    <h2 class="text-2xl font-bold mb-4">Your Clicks This Month</h2>
                    <p class="text-6xl font-bold theme-text-primary" id="total-clicks">0</p>
                </div>

                <h2 class="text-3xl font-bold mb-6">Eligibility & Rewards</h2>
                <div class="grid md:grid-cols-2 lg:grid-cols-5 gap-6">
                    <!-- Tiers will be dynamically generated here -->
                </div>
            </div>

            <!-- Profile Page -->
            <div id="profile-page" class="page">
                <h1 class="text-4xl font-bold mb-8">Your Profile</h1>
                <div class="max-w-lg mx-auto theme-card p-8">
                    <form id="profile-form" class="space-y-6">
                        <div>
                            <label for="profile-name" class="block text-gray-700 mb-2">Name</label>
                            <input type="text" id="profile-name" class="w-full theme-input">
                        </div>
                        <div>
                            <label for="profile-email" class="block text-gray-700 mb-2">Email</label>
                            <input type="email" id="profile-email" class="w-full theme-input bg-gray-100 cursor-not-allowed" readonly>
                        </div>
                        <div>
                            <label for="profile-password" class="block text-gray-700 mb-2">New Password (optional)</label>
                            <input type="password" id="profile-password" class="w-full theme-input" placeholder="Leave blank to keep current password">
                        </div>
                        <!-- Resume Section -->
                        <div class="border-t pt-6">
                             <h3 class="text-xl font-bold mb-4">Your Resume</h3>
                             <p id="resume-status" class="text-gray-600 mb-4">You have not created a resume yet.</p>
                             <button type="button" id="add-resume-btn" class="w-full theme-btn bg-yellow-500 hover:bg-yellow-600">Add / Edit Resume</button>
                        </div>
                        <!-- Phone Verification Section -->
                        <div id="phone-verification-section" class="border-t pt-6">
                            <h3 class="text-xl font-bold mb-4">Phone Verification</h3>
                            <div id="phone-verified-status" class="hidden p-3 rounded-lg bg-green-100 text-green-800 mb-4 flex items-center">
                                <svg class="w-5 h-5 mr-2 inline" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                                Your phone number is verified!
                            </div>
                            <div id="phone-input-group">
                                <label for="profile-phone" class="block text-gray-700 mb-2">Phone Number</label>
                                <input type="tel" id="profile-phone" class="w-full theme-input" placeholder="+1234567890">
                                <button type="button" id="save-phone-btn" class="mt-2 w-full theme-btn theme-btn-secondary">Save Phone Number</button>
                            </div>
                            <div id="otp-input-group" class="hidden mt-4">
                                <p class="text-sm text-gray-600 mb-2">An OTP has been sent by the admin. Please enter it below.</p>
                                <label for="profile-otp" class="block text-gray-700 mb-2">4-Digit OTP</label>
                                <input type="text" id="profile-otp" maxlength="4" class="w-full theme-input" placeholder="1234">
                                <button type="button" id="verify-otp-btn" class="mt-2 w-full theme-btn">Verify OTP</button>
                            </div>
                            <div id="phone-verification-message" class="mt-4 text-center"></div>
                        </div>
                        <button type="submit" class="w-full theme-btn">Update Profile</button>
                    </form>
                       <div id="profile-message" class="text-green-500 mt-4 text-center"></div>
                </div>
            </div>

            <!-- Static Pages (Privacy, Terms, etc.) -->
            <div id="privacy-policy-page" class="page">
                 <div class="max-w-4xl mx-auto theme-card p-8">
                    <h1 class="text-4xl font-bold mb-6">Privacy Policy</h1>
                    <div class="space-y-4 text-gray-700 leading-relaxed">
                        <p>Your privacy is important to us. It is AutoSystem's policy to respect your privacy regarding any information we may collect from you across our website.</p>
                        <p>We only ask for personal information when we truly need it to provide a service to you. We collect it by fair and lawful means, with your knowledge and consent. We also let you know why we’re collecting it and how it will be used.</p>
                    </div>
                </div>
            </div>
            <div id="terms-condition-page" class="page">
                <div class="max-w-4xl mx-auto theme-card p-8">
                    <h1 class="text-4xl font-bold mb-6">Terms and Conditions</h1>
                    <div class="space-y-4 text-gray-700 leading-relaxed">
                        <p>With AutoSystem, you can earn money with us and build a brighter future. Our platform is designed for those who want a flexible, part-time opportunity to generate income.</p>
                    </div>
                </div>
            </div>
            <div id="contact-us-page" class="page">
                <div class="max-w-4xl mx-auto theme-card p-8 text-center">
                    <h1 class="text-4xl font-bold mb-6">Contact Us</h1>
                    <p class="text-lg text-gray-600 mb-4">Have questions? Reach out to us via email.</p>
                    <a href="mailto:contactmashab@gmail.com" class="text-2xl font-semibold theme-text-primary hover:underline">contactmashab@gmail.com</a>
                </div>
            </div>
            <div id="about-us-page" class="page">
                 <div class="max-w-4xl mx-auto theme-card p-8">
                    <h1 class="text-4xl font-bold mb-6">About Us</h1>
                    <div class="space-y-4 text-gray-700 leading-relaxed">
                        <p>AutoSystem is an innovative platform designed to empower individuals by providing a unique opportunity to earn rewards and build a career path through a simple, automated system.</p>
                    </div>
                </div>
            </div>

            <!-- Admin Login Page -->
            <div id="admin-login-page" class="page">
                <div class="max-w-md mx-auto theme-card p-10">
                    <h2 class="text-3xl font-bold mb-6 text-center text-gray-800">Admin Login</h2>
                    <form id="admin-login-form" class="space-y-6">
                        <div>
                            <label for="admin-email" class="block text-gray-700 mb-2">Admin Email</label>
                            <input type="email" id="admin-email" value="admin@system.com" class="w-full theme-input" required>
                        </div>
                        <div>
                            <label for="admin-password" class="block text-gray-700 mb-2">Admin Password</label>
                            <input type="password" id="admin-password" class="w-full theme-input" required>
                        </div>
                        <button type="submit" class="w-full theme-btn bg-gray-800 hover:bg-gray-900">Login as Admin</button>
                    </form>
                    <div id="admin-login-error" class="text-red-500 mt-4 text-center"></div>
                </div>
            </div>
            
            <!-- Admin Dashboard Page -->
            <div id="admin-dashboard-page" class="page">
                <div class="flex justify-between items-center mb-8">
                    <h1 class="text-4xl font-bold">Admin Dashboard</h1>
                    <button id="admin-logout-btn" class="theme-btn bg-red-600 hover:bg-red-700">Admin Logout</button>
                </div>
                
                <!-- Admin Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                    <!-- Admin cards will be populated here -->
                </div>

                <!-- Admin Views -->
                <div id="admin-views-container">
                    <!-- Views will be populated here -->
                </div>
            </div>

        </main>

        <!-- Footer -->
        <footer class="bg-white mt-12 border-t">
            <div class="container mx-auto px-6 py-8">
                <div class="flex flex-col md:flex-row justify-between items-center text-center md:text-left">
                    <p class="text-gray-600">&copy; 2024 AutoSystem. All rights reserved.</p>
                    <div class="flex space-x-6 mt-4 md:mt-0">
                        <a href="#" class="nav-link text-gray-600 hover:theme-text-primary" data-page="privacy-policy">Privacy Policy</a>
                        <a href="#" class="nav-link text-gray-600 hover:theme-text-primary" data-page="terms-condition">Terms & Conditions</a>
                        <a href="#" class="nav-link text-gray-600 hover:theme-text-primary" data-page="contact-us">Contact Us</a>
                        <a href="#" class="nav-link text-gray-600 hover:theme-text-primary" data-page="about-us">About Us</a>
                        <a href="#" id="admin-link" class="text-gray-600 hover:theme-text-primary">Admin</a>
                    </div>
                </div>
            </div>
        </footer>
    </div>
    
    <!-- Modals Container -->
    <div id="modals-container"></div>
    
    <!-- This div is for showing redirect messages -->
    <div id="redirect-container"></div>


    <!-- Firebase SDKs -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { 
            getAuth, 
            createUserWithEmailAndPassword, 
            signInWithEmailAndPassword, 
            onAuthStateChanged,
            signOut,
            updateProfile,
            updatePassword,
            sendPasswordResetEmail
        } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { 
            getFirestore, 
            doc, 
            setDoc, 
            getDoc,
            updateDoc,
            collection,
            addDoc,
            getDocs,
            query,
            where,
            Timestamp,
            onSnapshot,
            orderBy,
            limit,
            deleteDoc,
            runTransaction,
            writeBatch
        } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyA00mo8NGdqI4-L7Ode-dy0vTda3vExORM",
            authDomain: "automation-system-e0e57.firebaseapp.com",
            projectId: "automation-system-e0e57",
            storageBucket: "automation-system-e0e57.appspot.com",
            messagingSenderId: "679067303232",
            appId: "1:679067303232:web:6259337191075947dc0ea5",
            measurementId: "G-VVDBQHQYHG"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const { jsPDF } = window.jspdf;

        // --- UI Helper Functions ---
        function showLoading(button, text = "Loading...") {
            button.disabled = true;
            const btnText = button.querySelector('.btn-text');
            if(btnText) btnText.textContent = text;
        }

        function hideLoading(button, text) {
            button.disabled = false;
            const btnText = button.querySelector('.btn-text');
            if(btnText) btnText.textContent = text;
        }

        const modalsContainer = document.getElementById('modals-container');

        // --- Custom Modal Functions ---
        function showCustomModal(title, content, showClose = true) {
            const closeButton = showClose ? `<button id="close-modal-btn" class="text-gray-500 hover:text-gray-800 text-3xl">&times;</button>` : '';
            const modalHTML = `
                <div id="generic-modal" class="modal-backdrop">
                    <div class="modal-content w-11/12 md:w-1/3">
                        <div class="p-4 border-b flex justify-between items-center">
                            <h2 class="text-xl font-bold">${title}</h2>
                            ${closeButton}
                        </div>
                        <div class="p-6">
                            ${content}
                        </div>
                    </div>
                </div>
            `;
            modalsContainer.innerHTML = modalHTML;

            if (showClose) {
                document.getElementById('close-modal-btn').addEventListener('click', () => {
                    modalsContainer.innerHTML = '';
                });
            }
        }
        
        function showConfirmationModal(title, message, onConfirm) {
            const modalHTML = `
                <div id="confirmation-modal" class="modal-backdrop">
                    <div class="modal-content w-11/12 md:w-1/3">
                        <div class="p-4 border-b">
                            <h2 class="text-xl font-bold">${title}</h2>
                        </div>
                        <div class="p-6">
                            <p>${message}</p>
                        </div>
                        <div class="p-4 border-t flex justify-end space-x-4">
                            <button id="confirm-cancel-btn" class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">Cancel</button>
                            <button id="confirm-ok-btn" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">Confirm</button>
                        </div>
                    </div>
                </div>
            `;
            modalsContainer.innerHTML = modalHTML;
            
            document.getElementById('confirm-ok-btn').addEventListener('click', () => {
                onConfirm();
                modalsContainer.innerHTML = '';
            });

            document.getElementById('confirm-cancel-btn').addEventListener('click', () => {
                modalsContainer.innerHTML = '';
            });
        }

        function showPromptModal(title, message, onConfirm) {
            const modalHTML = `
                <div id="prompt-modal" class="modal-backdrop">
                    <div class="modal-content w-11/12 md:w-1/3">
                        <div class="p-4 border-b">
                            <h2 class="text-xl font-bold">${title}</h2>
                        </div>
                        <div class="p-6 space-y-4">
                            <p>${message}</p>
                            <input type="text" id="prompt-input" class="w-full theme-input">
                        </div>
                        <div class="p-4 border-t flex justify-end space-x-4">
                            <button id="prompt-cancel-btn" class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">Cancel</button>
                            <button id="prompt-ok-btn" class="theme-btn">Submit</button>
                        </div>
                    </div>
                </div>
            `;
            modalsContainer.innerHTML = modalHTML;

            document.getElementById('prompt-ok-btn').addEventListener('click', () => {
                const value = document.getElementById('prompt-input').value;
                if (value) {
                    onConfirm(value);
                }
                modalsContainer.innerHTML = '';
            });
            
            document.getElementById('prompt-cancel-btn').addEventListener('click', () => {
                modalsContainer.innerHTML = '';
            });
        }


        // --- Link Shortening & Generation ---
        function generateShortCode(originalUrl, userId, linkId) {
            const hash = (s) => {
                let h = 0;
                for(let i = 0; i < s.length; i++) {
                    h = (Math.imul(31, h) + s.charCodeAt(i)) | 0;
                }
                return Math.abs(h).toString(36).substring(0, 6);
            };
            return hash(originalUrl + userId + linkId);
        }
        
        function getShortUrl(shortCode) {
            const baseUrl = window.location.origin + window.location.pathname;
            return `${baseUrl}#/redirect/${shortCode}`;
        }

        // --- Redirect Handler ---
        const appContainer = document.getElementById('app-container');
        const redirectContainer = document.getElementById('redirect-container');

        async function handleRedirect() {
            if (window.location.hash.startsWith('#/redirect/')) {
                appContainer.classList.add('hidden');
                const shortCode = window.location.hash.substring('#/redirect/'.length);

                if (shortCode) {
                    redirectContainer.innerHTML = `<div class="w-screen h-screen flex justify-center items-center bg-gray-100"><div class="text-center"><h1 class="text-2xl font-bold theme-text-primary">Redirecting...</h1><p class="text-gray-600">Please wait.</p></div></div>`;
                    
                    const shortLinkRef = doc(db, "shortlinks", shortCode);
                    const shortLinkDoc = await getDoc(shortLinkRef);

                    if (shortLinkDoc.exists()) {
                        const { original, ownerId, linkId } = shortLinkDoc.data();
                        
                        try {
                            const userDocRef = doc(db, "users", ownerId);
                            const linkDocRef = doc(db, `users/${ownerId}/links`, linkId);

                            await runTransaction(db, async (transaction) => {
                                const userDoc = await transaction.get(userDocRef);
                                if (!userDoc.exists()) {
                                    throw "User document does not exist!";
                                }
                                const newTotalClicks = (userDoc.data().clicks || 0) + 1;
                                transaction.update(userDocRef, { clicks: newTotalClicks });

                                const linkDoc = await transaction.get(linkDocRef);
                                if(linkDoc.exists()){
                                    const newLinkClicks = (linkDoc.data().clicks || 0) + 1;
                                    transaction.update(linkDocRef, { clicks: newLinkClicks });
                                }
                            });
                            
                            window.location.replace(original);

                        } catch (e) {
                            console.error("Transaction failed: ", e);
                            redirectContainer.innerHTML = `<div class="w-screen h-screen flex justify-center items-center bg-gray-100"><div class="text-center"><h1 class="text-2xl font-bold text-red-600">Redirect Failed</h1><p class="text-gray-600">Could not process link click.</p></div></div>`;
                        }
                    } else {
                        redirectContainer.innerHTML = `<div class="w-screen h-screen flex justify-center items-center bg-gray-100"><div class="text-center"><h1 class="text-2xl font-bold text-red-600">Link Not Found</h1><p class="text-gray-600">The link you followed is invalid or has expired.</p></div></div>`;
                    }
                }
            } else {
                appContainer.classList.remove('hidden');
                redirectContainer.innerHTML = '';
            }
        }
        
        window.addEventListener('hashchange', handleRedirect);
        window.addEventListener('load', handleRedirect);


        // --- Page Navigation ---
        const pages = document.querySelectorAll('.page');
        const navLinks = document.querySelectorAll('.nav-link');

        function showPage(pageId, hideAll = false) {
            if (hideAll) {
                 pages.forEach(page => page.classList.remove('active'));
            }
            pages.forEach(page => {
                page.classList.toggle('active', page.id === `${pageId}-page`);
            });
            document.getElementById('mobile-menu').classList.add('hidden');
        }

        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const pageId = link.getAttribute('data-page');
                showPage(pageId);
            });
        });

        // --- Mobile Menu ---
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        mobileMenuButton.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });

        // --- Authentication State ---
        const loggedInElements = document.querySelectorAll('[data-page="main"], [data-page="dashboard"], [data-page="profile"], #logout-btn, #mobile-logout-btn, #notification-bell');
        const loggedOutLinks = document.querySelectorAll('[data-page="signin"], [data-page="signup"]');
        let unsubscribeNotifications = null;
        let unsubscribeUserData = null;
        let unsubscribeDirectMessages = null;

        onAuthStateChanged(auth, user => {
            if (user) {
                if (!window.location.hash.startsWith('#/redirect/')) {
                    loggedInElements.forEach(link => link.classList.remove('hidden'));
                    loggedOutLinks.forEach(link => link.classList.add('hidden'));
                    showPage('main');
                    loadUserData(user);
                    if (unsubscribeNotifications) unsubscribeNotifications();
                    if (unsubscribeDirectMessages) unsubscribeDirectMessages();
                    listenForNotifications(user.uid);
                }
            } else {
                if (!window.location.hash.startsWith('#/redirect/')) {
                    loggedInElements.forEach(link => link.classList.add('hidden'));
                    loggedOutLinks.forEach(link => link.classList.remove('hidden'));
                    showPage('signin');
                    if (unsubscribeNotifications) unsubscribeNotifications();
                    if (unsubscribeUserData) unsubscribeUserData();
                    if (unsubscribeDirectMessages) unsubscribeDirectMessages();
                }
            }
        });

        // --- Sign Up ---
        const signupForm = document.getElementById('signup-form');
        signupForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const submitBtn = signupForm.querySelector('button[type="submit"]');
            showLoading(submitBtn, "Signing Up...");
            const name = document.getElementById('signup-name').value;
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            const signupError = document.getElementById('signup-error');

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;

                await updateProfile(user, { displayName: name });

                const userDocRef = doc(db, "users", user.uid);
                await setDoc(userDocRef, {
                    name: name,
                    email: email,
                    clicks: 0,
                    phone: '',
                    phoneVerified: false,
                    phoneOtp: '',
                    claimedRewards: { starter: false, bronze: false, silver: false, gold: false, diamond: false },
                    seenNotifications: [],
                    seenDirectMessages: []
                });
                
                // For every global link that exists, create a corresponding link document for this new user.
                const globalLinksQuery = query(collection(db, "global_links"));
                const globalLinksSnapshot = await getDocs(globalLinksQuery);
                const batch = writeBatch(db);

                globalLinksSnapshot.forEach(linkDoc => {
                    const linkData = linkDoc.data();
                    const linkId = linkDoc.id;
                    const shortCode = generateShortCode(linkData.original, user.uid, linkId);
                    const shortUrl = getShortUrl(shortCode);
                    
                    const userLinkDocRef = doc(db, `users/${user.uid}/links`, linkId);
                    batch.set(userLinkDocRef, { original: linkData.original, short: shortUrl, clicks: 0, global: true });
                    
                    const shortLinkDocRef = doc(db, "shortlinks", shortCode);
                    batch.set(shortLinkDocRef, { original: linkData.original, ownerId: user.uid, linkId: linkId });
                });
                await batch.commit();
                
                signupForm.reset();
                signupError.textContent = '';

            } catch (error) {
                signupError.textContent = error.message;
            } finally {
                hideLoading(submitBtn, "Sign Up");
            }
        });

        // --- Sign In & Forgot Password ---
        const signinForm = document.getElementById('signin-form');
        signinForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const submitBtn = signinForm.querySelector('button[type="submit"]');
            showLoading(submitBtn, "Signing In...");
            const email = document.getElementById('signin-email').value;
            const password = document.getElementById('signin-password').value;
            const signinError = document.getElementById('signin-error');

            try {
                await signInWithEmailAndPassword(auth, email, password);
                signinForm.reset();
                signinError.textContent = '';
            } catch (error) {
                signinError.textContent = "Invalid email or password.";
            } finally {
                hideLoading(submitBtn, "Sign In");
            }
        });
        
        document.getElementById('forgot-password-link').addEventListener('click', (e) => {
            e.preventDefault();
            showPromptModal("Forgot Password", "Please enter your email address to receive a password reset link:", (email) => {
                 if (email) {
                    sendPasswordResetEmail(auth, email)
                        .then(() => {
                            showCustomModal("Success", "Password reset email sent! Please check your inbox.");
                        })
                        .catch((error) => {
                            showCustomModal("Error", "Error sending password reset email: " + error.message);
                        });
                }
            });
        });

        // --- Logout ---
        document.getElementById('logout-btn').addEventListener('click', () => { signOut(auth); window.location.hash = ''; });
        document.getElementById('mobile-logout-btn').addEventListener('click', () => { signOut(auth); window.location.hash = ''; });


        // --- Load User Data ---
        function loadUserData(user) {
            if (!user) return;
            if (unsubscribeUserData) unsubscribeUserData();

            const userDocRef = doc(db, "users", user.uid);
            
            unsubscribeUserData = onSnapshot(userDocRef, async (userDoc) => {
                if (userDoc.exists()) {
                    const userData = userDoc.data();
                    
                    await displayShortLinks(user.uid);
                    updateDashboard(userData.clicks || 0, userData.claimedRewards || {});
                    updatePhoneVerificationUI(userData);
                    checkUserAttendance(user.uid);

                    document.getElementById('profile-name').value = user.displayName || '';
                    document.getElementById('profile-email').value = user.email || '';
                    
                    const resumeDocRef = doc(db, `users/${user.uid}/resume`, 'data');
                    const resumeDoc = await getDoc(resumeDocRef);
                    document.getElementById('resume-status').textContent = resumeDoc.exists() 
                        ? 'You have a saved resume on file.'
                        : 'You have not created a resume yet.';
                } else {
                    console.log("User document not found!");
                }
            }, (error) => {
                console.error("Error listening to user data:", error);
            });
        }

        // --- Display Short Links (Main Page) ---
        async function displayShortLinks(userId) {
            const linksContainer = document.getElementById('short-links-container');
            const linksQuery = query(collection(db, `users/${userId}/links`));
            
            onSnapshot(linksQuery, (linksSnapshot) => {
                linksContainer.innerHTML = ''; 
                if (linksSnapshot.empty) {
                    linksContainer.innerHTML = '<p class="text-gray-600 col-span-full">No links have been assigned to you yet.</p>';
                    return;
                }
                
                linksSnapshot.forEach(doc => {
                    const linkData = doc.data();
                    const linkCard = `
                        <div class="theme-card p-6">
                            <p class="text-sm text-gray-500 truncate" title="${linkData.original}">Original: ${linkData.original}</p>
                            <a href="${linkData.short}" target="_blank" class="text-lg font-semibold theme-text-primary hover:underline break-all">${linkData.short}</a>
                            <p class="text-gray-700 mt-2">Clicks: <span class="font-bold">${linkData.clicks || 0}</span></p>
                            <button class="copy-btn mt-4 bg-gray-200 text-gray-800 px-4 py-2 rounded-md hover:bg-gray-300 w-full" data-link="${linkData.short}">Copy Link</button>
                        </div>
                    `;
                    linksContainer.innerHTML += linkCard;
                });

                document.querySelectorAll('.copy-btn').forEach(button => {
                    button.addEventListener('click', () => {
                        const linkToCopy = button.getAttribute('data-link');
                        const textArea = document.createElement("textarea");
                        textArea.value = linkToCopy;
                        document.body.appendChild(textArea);
                        textArea.select();
                        try {
                            document.execCommand('copy');
                            button.textContent = 'Copied!';
                        } catch (err) {
                            console.error('Fallback: Oops, unable to copy', err);
                            button.textContent = 'Error!';
                        }
                        document.body.removeChild(textArea);
                        setTimeout(() => { button.textContent = 'Copy Link'; }, 2000);
                    });
                });
            }, (error) => {
                console.error("Error fetching links:", error);
                linksContainer.innerHTML = '<p class="text-red-500 col-span-full">Could not load links. Please try again later.</p>';
            });
        }

        // --- Profile Update ---
        const profileForm = document.getElementById('profile-form');
        profileForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const user = auth.currentUser;
            if (!user) return;

            const name = document.getElementById('profile-name').value;
            const newPassword = document.getElementById('profile-password').value;
            const profileMessage = document.getElementById('profile-message');
            
            profileMessage.textContent = 'Updating...';
            profileMessage.className = 'text-green-500 mt-4 text-center';

            try {
                if (name !== user.displayName) {
                    await updateProfile(user, { displayName: name });
                    const userDocRef = doc(db, "users", user.uid);
                    await updateDoc(userDocRef, { name: name });
                }

                if (newPassword) {
                    await updatePassword(user, newPassword);
                }

                profileMessage.textContent = 'Profile updated successfully!';
                document.getElementById('profile-password').value = '';
                setTimeout(() => { profileMessage.textContent = ''; }, 3000);

            } catch (error) {
                profileMessage.textContent = `Error: ${error.message}`;
                profileMessage.className = 'text-red-500 mt-4 text-center';
            }
        });
        
        // --- Phone Verification Logic ---
        function updatePhoneVerificationUI(userData) {
            const phoneInputGroup = document.getElementById('phone-input-group');
            const otpInputGroup = document.getElementById('otp-input-group');
            const verifiedStatus = document.getElementById('phone-verified-status');
            const phoneInput = document.getElementById('profile-phone');
            
            phoneInput.value = userData.phone || '';
            
            if (userData.phoneVerified) {
                phoneInputGroup.classList.add('hidden');
                otpInputGroup.classList.add('hidden');
                verifiedStatus.classList.remove('hidden');
            } else if (userData.phone && userData.phoneOtp) {
                phoneInputGroup.classList.add('hidden');
                otpInputGroup.classList.remove('hidden');
                verifiedStatus.classList.add('hidden');
            } else {
                phoneInputGroup.classList.remove('hidden');
                otpInputGroup.classList.add('hidden');
                verifiedStatus.classList.add('hidden');
            }
        }
        
        document.getElementById('save-phone-btn').addEventListener('click', async () => {
            const user = auth.currentUser;
            if (!user) return;
            const phone = document.getElementById('profile-phone').value;
            const messageEl = document.getElementById('phone-verification-message');
            
            if (!/^\+[1-9]\d{1,14}$/.test(phone)) {
                messageEl.textContent = 'Please enter a valid phone number in E.164 format (e.g., +14155552671).';
                messageEl.className = 'mt-4 text-center text-red-500';
                return;
            }
            
            const userDocRef = doc(db, "users", user.uid);
            await updateDoc(userDocRef, { phone: phone, phoneVerified: false });
            messageEl.textContent = 'Phone number saved. Please wait for an admin to send an OTP.';
            messageEl.className = 'mt-4 text-center text-green-500';
            updatePhoneVerificationUI({ phone: phone, phoneVerified: false, phoneOtp: '' });
        });

        document.getElementById('verify-otp-btn').addEventListener('click', async () => {
            const user = auth.currentUser;
            if (!user) return;
            const otp = document.getElementById('profile-otp').value;
            const messageEl = document.getElementById('phone-verification-message');
            
            const userDocRef = doc(db, "users", user.uid);
            const userDoc = await getDoc(userDocRef);
            const userData = userDoc.data();
            
            if (otp && otp === userData.phoneOtp) {
                await updateDoc(userDocRef, { phoneVerified: true, phoneOtp: '' });
                messageEl.textContent = 'Phone verified successfully!';
                messageEl.className = 'mt-4 text-center text-green-500';
                updatePhoneVerificationUI({ ...userData, phoneVerified: true });
            } else {
                messageEl.textContent = 'Invalid OTP. Please try again.';
                messageEl.className = 'mt-4 text-center text-red-500';
            }
        });

        // --- Dashboard & Rewards ---
        function updateDashboard(clicks, claimedRewards) {
            document.getElementById('total-clicks').textContent = clicks;

            const tiers = {
                starter: { clicks: 5, color: 'green-500', name: 'Starter' },
                bronze: { clicks: 7500, color: 'yellow-600', name: 'Bronze' },
                silver: { clicks: 15000, color: 'gray-400', name: 'Silver' },
                gold: { clicks: 50000, color: 'yellow-400', name: 'Gold' },
                diamond: { clicks: 100000, color: 'blue-400', name: 'Diamond' }
            };
            
            const rewardsContainer = document.querySelector('#dashboard-page .grid');
            rewardsContainer.innerHTML = '';

            for (const [tier, data] of Object.entries(tiers)) {
                const progress = Math.min((clicks / data.clicks) * 100, 100);
                
                const card = document.createElement('div');
                card.className = 'theme-card p-6 border-l-4';
                card.style.borderColor = data.color.split('-')[0];

                let buttonStateClass = 'bg-gray-400 cursor-not-allowed';
                let buttonText = 'Claim Reward';
                let buttonDisabled = true;

                if (claimedRewards[tier]) {
                    buttonStateClass = 'bg-green-600';
                    buttonText = 'Claimed';
                } else if (clicks >= data.clicks) {
                    buttonStateClass = `bg-${data.color} hover:bg-${data.color.replace('500','600')}`;
                    buttonDisabled = false;
                }

                card.innerHTML = `
                    <h3 class="text-xl font-bold mb-2 text-${data.color}">${data.name} Tier</h3>
                    <p class="text-gray-600 mb-4">${data.clicks.toLocaleString()} clicks</p>
                    <div class="w-full bg-gray-200 rounded-full h-4 mb-4">
                        <div class="bg-${data.color} h-4 rounded-full" style="width: ${progress}%;"></div>
                    </div>
                    ${tier === 'gold' ? '<p class="text-sm text-green-600 font-semibold mt-2">Eligible to work with us!</p>' : ''}
                    <button class="claim-btn w-full text-white py-2 rounded-lg mt-4 ${buttonStateClass}" data-tier="${tier}" ${buttonDisabled ? 'disabled' : ''}>${buttonText}</button>
                `;
                rewardsContainer.appendChild(card);
            }
        }

        document.querySelector('#dashboard-page').addEventListener('click', async (e) => {
            if (e.target.classList.contains('claim-btn')) {
                const user = auth.currentUser;
                if (!user || e.target.disabled) return;

                const tier = e.target.dataset.tier;
                const userDocRef = doc(db, "users", user.uid);
                
                try {
                    await updateDoc(userDocRef, {
                        [`claimedRewards.${tier}`]: true
                    });
                    showCustomModal("Success", `You have successfully claimed the ${tier} tier reward!`);
                } catch (error) {
                    console.error("Error claiming reward: ", error);
                    showCustomModal("Error", "Could not claim reward. Please try again.");
                }
            }
        });

        // --- Attendance ---
        async function checkUserAttendance(userId) {
            const today = new Date().toISOString().split('T')[0];
            const attendanceDocRef = doc(db, `users/${userId}/attendance`, today);
            const statusEl = document.getElementById('attendance-status');
            const buttonEl = document.getElementById('mark-attendance-btn');

            try {
                const attendanceDoc = await getDoc(attendanceDocRef);
                if (attendanceDoc.exists()) {
                    statusEl.textContent = `Attendance marked for today at ${attendanceDoc.data().timestamp.toDate().toLocaleTimeString()}`;
                    statusEl.className = 'mt-4 text-center font-semibold text-green-600';
                    buttonEl.disabled = true;
                    buttonEl.textContent = 'Attendance Marked';
                    buttonEl.classList.remove('bg-green-500', 'hover:bg-green-600');
                    buttonEl.classList.add('bg-gray-400', 'cursor-not-allowed');
                } else {
                    statusEl.textContent = 'You have not marked your attendance for today.';
                    statusEl.className = 'mt-4 text-center font-semibold text-red-600';
                    buttonEl.disabled = false;
                    buttonEl.textContent = 'Mark Attendance';
                    buttonEl.classList.add('bg-green-500', 'hover:bg-green-600');
                    buttonEl.classList.remove('bg-gray-400', 'cursor-not-allowed');
                }
            } catch (error) {
                console.error("Error checking attendance:", error);
                statusEl.textContent = 'Could not check attendance status.';
                statusEl.className = 'mt-4 text-center font-semibold text-red-500';
            }
        }

        document.getElementById('attendance-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const user = auth.currentUser;
            if (!user) return;

            const workLink = document.getElementById('attendance-link').value;
            const today = new Date().toISOString().split('T')[0];
            const attendanceDocRef = doc(db, `users/${user.uid}/attendance`, today);

            try {
                await setDoc(attendanceDocRef, {
                    link: workLink,
                    timestamp: Timestamp.now()
                });
                checkUserAttendance(user.uid);
            } catch (error) {
                console.error("Error marking attendance: ", error);
                document.getElementById('attendance-status').textContent = 'Error: Could not mark attendance.';
                document.getElementById('attendance-status').className = 'mt-4 text-center font-semibold text-red-500';
            }
        });

        // --- Resume Management ---
        document.getElementById('add-resume-btn').addEventListener('click', async () => {
            const user = auth.currentUser;
            if (!user) return;

            const resumeDocRef = doc(db, `users/${user.uid}/resume`, 'data');
            const resumeDoc = await getDoc(resumeDocRef);
            const resumeData = resumeDoc.exists() ? resumeDoc.data() : {};

            const modalContent = `
                <form id="resume-form" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Full Name</label>
                        <input type="text" id="resume-name" class="mt-1 block w-full theme-input" value="${resumeData.name || user.displayName || ''}" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Email</label>
                        <input type="email" id="resume-email" class="mt-1 block w-full theme-input bg-gray-100" value="${user.email}" readonly>
                    </div>
                     <div>
                        <label class="block text-sm font-medium text-gray-700">Phone</label>
                        <input type="tel" id="resume-phone" class="mt-1 block w-full theme-input" value="${resumeData.phone || ''}" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Professional Summary</label>
                        <textarea id="resume-summary" rows="4" class="mt-1 block w-full theme-input" required>${resumeData.summary || ''}</textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Experience</label>
                        <textarea id="resume-experience" rows="6" class="mt-1 block w-full theme-input" placeholder="Company Name - Job Title (YYYY-MM to YYYY-MM)\n- Responsibility 1\n- Responsibility 2" required>${resumeData.experience || ''}</textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Education</label>
                        <textarea id="resume-education" rows="4" class="mt-1 block w-full theme-input" placeholder="University Name - Degree (YYYY-MM to YYYY-MM)" required>${resumeData.education || ''}</textarea>
                    </div>
                    <button type="submit" class="w-full theme-btn">Save Resume</button>
                    <div id="resume-form-status" class="text-center mt-2"></div>
                </form>
            `;
            showCustomModal('Create / Edit Your Resume', modalContent);

            document.getElementById('resume-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const statusEl = document.getElementById('resume-form-status');
                statusEl.textContent = 'Saving...';
                const updatedResumeData = {
                    name: document.getElementById('resume-name').value,
                    email: document.getElementById('resume-email').value,
                    phone: document.getElementById('resume-phone').value,
                    summary: document.getElementById('resume-summary').value,
                    experience: document.getElementById('resume-experience').value,
                    education: document.getElementById('resume-education').value,
                    updatedAt: Timestamp.now()
                };
                
                try {
                    await setDoc(resumeDocRef, updatedResumeData);
                    statusEl.textContent = 'Resume saved successfully!';
                    statusEl.className = 'text-center mt-2 text-green-600';
                    document.getElementById('resume-status').textContent = 'You have a saved resume on file.';
                    setTimeout(() => document.getElementById('modals-container').innerHTML = '', 2000);
                } catch (error) {
                    console.error("Error saving resume: ", error);
                    statusEl.textContent = 'Error saving resume.';
                    statusEl.className = 'text-center mt-2 text-red-600';
                }
            });
        });


        // --- Admin Panel Logic ---
        document.getElementById('admin-link').addEventListener('click', (e) => {
            e.preventDefault();
            showPage('admin-login', true);
            document.querySelector('nav').classList.add('hidden');
            document.querySelector('footer').classList.add('hidden');
        });

        document.getElementById('admin-login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('admin-email').value;
            const password = document.getElementById('admin-password').value;
            const errorEl = document.getElementById('admin-login-error');

            if (email === 'admin@system.com' && password === '123') {
                errorEl.textContent = '';
                showPage('admin-dashboard', true);
                setupAdminDashboard();
            } else {
                errorEl.textContent = 'Invalid admin credentials.';
            }
        });

        document.getElementById('admin-logout-btn').addEventListener('click', () => {
            document.querySelector('nav').classList.remove('hidden');
            document.querySelector('footer').classList.remove('hidden');
            window.location.reload();
        });
        
        function setupAdminDashboard() {
            const adminCardContainer = document.querySelector('#admin-dashboard-page .grid');
            adminCardContainer.innerHTML = '';
            const adminViewsContainer = document.getElementById('admin-views-container');
            adminViewsContainer.innerHTML = '';

            const adminSections = {
                'admin-view-users': { title: 'User Details', desc: 'View, message, and manage users.', color: 'blue-600', viewGenerator: generateUsersView, action: loadAllUsers },
                'admin-view-attendance': { title: 'User Attendance', desc: 'See who is present today.', color: 'green-600', viewGenerator: generateAttendanceView, action: loadAdminAttendance },
                'admin-view-cvs': { title: 'User Resumes', desc: 'Review submitted resumes.', color: 'yellow-600', viewGenerator: generateCvsView, action: loadAdminCVs },
                'admin-view-links': { title: 'Manage Links', desc: 'Add or remove global links.', color: 'purple-600', viewGenerator: generateLinksView, action: loadGlobalLinks },
                'admin-view-notifications': { title: 'Send Notification', desc: 'Broadcast a message to all users.', color: 'pink-600', viewGenerator: generateNotificationsView, action: null }
            };

            for (const [id, data] of Object.entries(adminSections)) {
                // Create Card Button
                const cardBtn = document.createElement('button');
                cardBtn.dataset.target = id;
                cardBtn.className = 'admin-card-btn theme-card p-6 text-left';
                cardBtn.innerHTML = `
                    <h3 class="text-xl font-bold text-${data.color}">${data.title}</h3>
                    <p class="text-gray-600 mt-2">${data.desc}</p>
                `;
                adminCardContainer.appendChild(cardBtn);

                // Create View Container
                const viewDiv = document.createElement('div');
                viewDiv.id = id;
                viewDiv.className = 'admin-view hidden';
                viewDiv.innerHTML = data.viewGenerator();
                adminViewsContainer.appendChild(viewDiv);

                cardBtn.addEventListener('click', () => {
                    document.querySelectorAll('.admin-view').forEach(v => v.classList.add('hidden'));
                    document.getElementById(id).classList.remove('hidden');
                    if (data.action) data.action();
                });
            }

            // Default view
            document.getElementById('admin-view-users').classList.remove('hidden');
            loadAllUsers();
        }

        function generateUsersView() {
            return `
                <div class="theme-card p-8">
                    <h2 class="text-2xl font-bold mb-4">All Users</h2>
                    <input type="text" id="admin-user-search" class="w-full mb-4 theme-input" placeholder="Search by name or email...">
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead><tr class="bg-gray-100"><th class="p-4">User</th><th class="p-4">Phone</th><th class="p-4">Clicks</th><th class="p-4">Actions</th></tr></thead>
                            <tbody id="admin-all-users-list"></tbody>
                        </table>
                    </div>
                </div>`;
        }
        function generateAttendanceView() {
            return `
                <div class="theme-card p-8">
                    <h2 class="text-2xl font-bold mb-4">User Attendance (<span id="today-date"></span>)</h2>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead><tr class="bg-gray-100"><th class="p-4">User</th><th class="p-4">Status</th><th class="p-4">Submitted Link</th></tr></thead>
                            <tbody id="admin-attendance-list"></tbody>
                        </table>
                    </div>
                </div>`;
        }
        function generateCvsView() {
            return `
                <div class="theme-card p-8">
                    <h2 class="text-2xl font-bold mb-4">Submitted Resumes</h2>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead><tr class="bg-gray-100"><th class="p-4">User</th><th class="p-4">Email</th><th class="p-4">Actions</th></tr></thead>
                            <tbody id="admin-cv-list"></tbody>
                        </table>
                    </div>
                </div>`;
        }
        function generateLinksView() {
             return `
                <div class="theme-card p-8">
                    <h2 class="text-2xl font-bold mb-4">Add New Global Link</h2>
                    <form id="add-link-form">
                        <input type="url" id="new-link-url" class="w-full theme-input" placeholder="https://example.com" required>
                        <button type="submit" class="mt-2 w-full theme-btn">Add Link for All Users</button>
                    </form>
                    <div id="add-link-status" class="mt-2 text-center"></div>
                </div>
                <div class="theme-card p-8 mt-8">
                    <h2 class="text-2xl font-bold mb-4">Manage Global Links</h2>
                    <div id="global-links-list" class="space-y-2"></div>
                </div>`;
        }
        function generateNotificationsView() {
            return `
                <div class="theme-card p-8">
                    <h2 class="text-2xl font-bold mb-4">Send Notification to All Users</h2>
                    <form id="notification-form">
                        <div class="mb-4">
                            <label for="notification-message" class="block text-gray-700 mb-2">Message</label>
                            <textarea id="notification-message" rows="4" class="w-full theme-input" placeholder="Type your announcement here..." required></textarea>
                        </div>
                        <button type="submit" class="w-full theme-btn">Send Notification</button>
                    </form>
                    <div id="notification-send-status" class="text-green-500 mt-4 text-center font-semibold"></div>
                </div>`;
        }
        
        async function loadAllUsers() {
             const userListBody = document.getElementById('admin-all-users-list');
            userListBody.innerHTML = '<tr><td colspan="4" class="p-4 text-center">Loading...</td></tr>';
            try {
                const usersCollectionRef = collection(db, "users");
                const userSnapshot = await getDocs(usersCollectionRef);
                let users = userSnapshot.docs.map(d => ({ id: d.id, ...d.data() }));
                
                function renderUsers(userArray) {
                    userListBody.innerHTML = '';
                    if (userArray.length === 0) {
                        userListBody.innerHTML = '<tr><td colspan="4" class="p-4 text-center">No users found.</td></tr>';
                        return;
                    }
                    userArray.forEach(user => {
                        const phoneStatus = user.phoneVerified 
                            ? `<span class="text-green-600 font-semibold">Verified</span>` 
                            : (user.phone ? `<span class="text-yellow-600 font-semibold">Pending</span>` : `<span>Not Added</span>`);
                        const row = document.createElement('tr');
                        row.className = 'border-b';
                        row.innerHTML = `
                            <td class="p-4"><div class="font-semibold">${user.name}</div><div class="text-sm text-gray-500">${user.email}</div></td>
                            <td class="p-4">${user.phone || 'N/A'} (${phoneStatus})</td>
                            <td class="p-4 font-bold">${user.clicks || 0}</td>
                            <td class="p-4"><button data-userid="${user.id}" class="details-btn theme-btn text-sm py-1 px-3">Details</button></td>
                        `;
                        userListBody.appendChild(row);
                    });
                }
                
                renderUsers(users);
                
                document.getElementById('admin-user-search').addEventListener('input', (e) => {
                    const searchTerm = e.target.value.toLowerCase();
                    const filteredUsers = users.filter(u => u.name.toLowerCase().includes(searchTerm) || u.email.toLowerCase().includes(searchTerm));
                    renderUsers(filteredUsers);
                });

                userListBody.addEventListener('click', e => {
                    if (e.target.classList.contains('details-btn')) {
                        const userId = e.target.dataset.userid;
                        const userData = users.find(u => u.id === userId);
                        openUserDetailsModal(userData);
                    }
                });
            } catch (error) {
                console.error("Error loading users:", error);
                userListBody.innerHTML = '<tr><td colspan="4" class="p-4 text-center text-red-500">Could not load users.</td></tr>';
            }
        }
        
        async function openUserDetailsModal(user) {
            
            const phoneStatus = user.phoneVerified ? 'Verified' : (user.phone ? 'Pending' : 'Not Added');
            const phoneAction = !user.phoneVerified && user.phone 
                ? `<button id="generate-otp-btn" class="theme-btn bg-blue-500 hover:bg-blue-600 text-sm py-1 px-3">Generate OTP</button>`
                : '';

            const modalHTML = `
                <div id="user-details-modal" class="modal-backdrop">
                    <div class="modal-content w-11/12 md:w-1/2 lg:w-1/3">
                        <div class="p-6 border-b flex justify-between items-center">
                            <h2 class="text-2xl font-bold">${user.name}</h2>
                            <button id="close-modal-btn" class="text-gray-500 hover:text-gray-800 text-3xl">&times;</button>
                        </div>
                        <div class="p-6 space-y-4">
                            <p><strong>Email:</strong> ${user.email}</p>
                            <p><strong>Phone:</strong> ${user.phone || 'N/A'} (<span class="font-semibold">${phoneStatus}</span>)</p>
                            <div id="otp-display" class="my-2"></div>
                            <div>${phoneAction}</div>
                            <hr>
                            <h3 class="font-bold">Send Direct Message</h3>
                            <textarea id="direct-message-text" class="w-full theme-input" rows="3" placeholder="Type your message..."></textarea>
                            <button id="send-direct-message-btn" class="theme-btn bg-green-500 hover:bg-green-600 text-sm py-1 px-3">Send Message</button>
                            <div id="direct-message-status" class="text-sm mt-2"></div>
                        </div>
                    </div>
                </div>
            `;
            modalsContainer.innerHTML = modalHTML;
            
            document.getElementById('close-modal-btn').addEventListener('click', () => {
                modalsContainer.innerHTML = '';
            });

            if (document.getElementById('generate-otp-btn')) {
                document.getElementById('generate-otp-btn').addEventListener('click', async () => {
                    const otp = Math.floor(1000 + Math.random() * 9000).toString();
                    const userDocRef = doc(db, "users", user.id);
                    await updateDoc(userDocRef, { phoneOtp: otp });
                    document.getElementById('otp-display').innerHTML = `<p class="text-green-600">OTP Generated: <strong class="text-lg">${otp}</strong>. Please provide this to the user.</p>`;
                    document.getElementById('generate-otp-btn').style.display = 'none';
                });
            }
            
            document.getElementById('send-direct-message-btn').addEventListener('click', async () => {
                const message = document.getElementById('direct-message-text').value;
                if (!message) return;
                
                const messageRef = collection(db, `users/${user.id}/direct_messages`);
                await addDoc(messageRef, {
                    message: message,
                    from: 'admin',
                    timestamp: Timestamp.now(),
                    seen: false
                });
                
                document.getElementById('direct-message-status').textContent = 'Message sent!';
                document.getElementById('direct-message-text').value = '';
                setTimeout(() => { document.getElementById('direct-message-status').textContent = ''; }, 3000);
            });
        }
        
        // --- Admin: Attendance View ---
        async function loadAdminAttendance() {
            const listBody = document.getElementById('admin-attendance-list');
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('today-date').textContent = new Date().toLocaleDateString();
            listBody.innerHTML = '<tr><td colspan="3" class="p-4 text-center">Loading...</td></tr>';

            try {
                const usersCollectionRef = collection(db, "users");
                const userSnapshot = await getDocs(usersCollectionRef);
                let attendanceData = [];

                for (const userDoc of userSnapshot.docs) {
                    const user = { id: userDoc.id, ...userDoc.data() };
                    const attendanceDocRef = doc(db, `users/${user.id}/attendance`, today);
                    const attendanceDoc = await getDoc(attendanceDocRef);
                    
                    attendanceData.push({
                        name: user.name,
                        email: user.email,
                        present: attendanceDoc.exists(),
                        link: attendanceDoc.exists() ? attendanceDoc.data().link : 'N/A'
                    });
                }

                listBody.innerHTML = '';
                if (attendanceData.length === 0) {
                     listBody.innerHTML = '<tr><td colspan="3" class="p-4 text-center">No users found.</td></tr>';
                     return;
                }

                attendanceData.forEach(item => {
                    const status = item.present ? '<span class="text-green-600 font-bold">Present</span>' : '<span class="text-red-600">Absent</span>';
                    const link = item.present ? `<a href="${item.link}" target="_blank" class="theme-text-primary hover:underline">${item.link}</a>` : 'N/A';
                    const row = `
                        <tr class="border-b">
                            <td class="p-4"><div class="font-semibold">${item.name}</div><div class="text-sm text-gray-500">${item.email}</div></td>
                            <td class="p-4">${status}</td>
                            <td class="p-4 truncate" style="max-width: 300px;">${link}</td>
                        </tr>
                    `;
                    listBody.innerHTML += row;
                });
            } catch (error) {
                console.error("Error loading attendance:", error);
                listBody.innerHTML = '<tr><td colspan="3" class="p-4 text-center text-red-500">Could not load attendance data.</td></tr>';
            }
        }

        // --- Admin: CVs View ---
        async function loadAdminCVs() {
            const listBody = document.getElementById('admin-cv-list');
            listBody.innerHTML = '<tr><td colspan="3" class="p-4 text-center">Loading...</td></tr>';
            
            try {
                const usersCollectionRef = collection(db, "users");
                const userSnapshot = await getDocs(usersCollectionRef);
                let cvData = [];

                for (const userDoc of userSnapshot.docs) {
                    const user = { id: userDoc.id, ...userDoc.data() };
                    const resumeDocRef = doc(db, `users/${user.id}/resume`, 'data');
                    const resumeDoc = await getDoc(resumeDocRef);
                    if (resumeDoc.exists()) {
                        cvData.push({ ...user, resume: resumeDoc.data() });
                    }
                }

                listBody.innerHTML = '';
                if (cvData.length === 0) {
                     listBody.innerHTML = '<tr><td colspan="3" class="p-4 text-center">No resumes submitted yet.</td></tr>';
                     return;
                }

                cvData.forEach(user => {
                    const row = document.createElement('tr');
                    row.className = 'border-b';
                    row.innerHTML = `
                        <td class="p-4 font-semibold">${user.name}</td>
                        <td class="p-4">${user.email}</td>
                        <td class="p-4"><button data-userid="${user.id}" class="view-cv-btn theme-btn bg-yellow-500 hover:bg-yellow-600 text-sm py-1 px-3">View Resume</button></td>
                    `;
                    listBody.appendChild(row);
                });

                listBody.addEventListener('click', e => {
                    if (e.target.classList.contains('view-cv-btn')) {
                        const userId = e.target.dataset.userid;
                        const userData = cvData.find(u => u.id === userId);
                        generateAndShowPDF(userData.resume);
                    }
                });
            } catch (error) {
                console.error("Error loading resumes:", error);
                listBody.innerHTML = '<tr><td colspan="3" class="p-4 text-center text-red-500">Could not load resumes.</td></tr>';
            }
        }

        function generateAndShowPDF(resumeData) {
            const doc = new jsPDF();
            let y = 20;

            doc.setFontSize(22);
            doc.text(resumeData.name, 105, y, { align: 'center' });
            y += 8;
            doc.setFontSize(12);
            doc.text(`${resumeData.email} | ${resumeData.phone}`, 105, y, { align: 'center' });
            y += 15;

            doc.setFontSize(16);
            doc.text('Professional Summary', 20, y);
            y += 7;
            doc.setFontSize(11);
            doc.text(doc.splitTextToSize(resumeData.summary, 170), 20, y);
            y += (doc.getTextDimensions(doc.splitTextToSize(resumeData.summary, 170)).h) + 10;

            doc.setFontSize(16);
            doc.text('Experience', 20, y);
            y += 7;
            doc.setFontSize(11);
            doc.text(doc.splitTextToSize(resumeData.experience, 170), 20, y);
            y += (doc.getTextDimensions(doc.splitTextToSize(resumeData.experience, 170)).h) + 10;

            doc.setFontSize(16);
            doc.text('Education', 20, y);
            y += 7;
            doc.setFontSize(11);
            doc.text(doc.splitTextToSize(resumeData.education, 170), 20, y);

            doc.output('dataurlnewwindow');
        }

        // --- Admin: Links View ---
        async function loadGlobalLinks() {
            const linksList = document.getElementById('global-links-list');
            const q = query(collection(db, "global_links"));
            onSnapshot(q, (snapshot) => {
                linksList.innerHTML = '';
                if (snapshot.empty) {
                    linksList.innerHTML = '<p>No global links exist.</p>';
                    return;
                }
                snapshot.forEach(doc => {
                    const linkData = doc.data();
                    const linkId = doc.id;
                    const el = document.createElement('div');
                    el.className = 'flex justify-between items-center bg-gray-100 p-2 rounded';
                    el.innerHTML = `
                        <span class="truncate">${linkData.original}</span>
                        <button data-linkid="${linkId}" class="delete-link-btn bg-red-500 text-white px-2 py-1 text-xs rounded hover:bg-red-600">Delete</button>
                    `;
                    linksList.appendChild(el);
                });
            });
        }

        document.getElementById('admin-views-container').addEventListener('click', async (e) => {
            if (e.target.classList.contains('delete-link-btn')) {
                const linkId = e.target.dataset.linkid;
                showConfirmationModal(
                    'Delete Global Link', 
                    'Are you sure you want to delete this global link? It will be removed for all users immediately.',
                    async () => {
                        try {
                            const usersSnapshot = await getDocs(collection(db, "users"));
                            const batch = writeBatch(db);
                            usersSnapshot.forEach(userDoc => {
                                const userLinkRef = doc(db, `users/${userDoc.id}/links`, linkId);
                                batch.delete(userLinkRef);
                            });
                            const globalLinkRef = doc(db, "global_links", linkId);
                            batch.delete(globalLinkRef);
                            await batch.commit();
                            showCustomModal('Success', 'Global link deleted for all users.');

                        } catch (error) {
                            console.error("Error deleting global link:", error);
                            showCustomModal("Error", "Could not completely remove the link. Please check the console.");
                        }
                    }
                );
            }
        });

        document.getElementById('admin-views-container').addEventListener('submit', async (e) => {
             if (e.target.id === 'add-link-form') {
                e.preventDefault();
                const statusEl = document.getElementById('add-link-status');
                const url = document.getElementById('new-link-url').value;
                statusEl.textContent = 'Adding link...';

                try {
                    const globalLinkRef = await addDoc(collection(db, "global_links"), { original: url, createdAt: Timestamp.now() });
                    const linkId = globalLinkRef.id;

                    const usersSnapshot = await getDocs(collection(db, "users"));
                    const batch = writeBatch(db);

                    usersSnapshot.forEach(userDoc => {
                        const userId = userDoc.id;
                        const shortCode = generateShortCode(url, userId, linkId);
                        const shortUrl = getShortUrl(shortCode);

                        const userLinkRef = doc(db, `users/${userId}/links`, linkId);
                        batch.set(userLinkRef, { original: url, short: shortUrl, clicks: 0, global: true });

                        const shortLinkDocRef = doc(db, "shortlinks", shortCode);
                        batch.set(shortLinkDocRef, { original: url, ownerId: userId, linkId: linkId });
                    });

                    await batch.commit();
                    
                    statusEl.textContent = 'Global link added successfully for all users!';
                    statusEl.className = 'mt-2 text-center text-green-600';
                    e.target.reset();
                } catch (error) {
                    console.error("Error adding global link:", error);
                    statusEl.textContent = 'Error adding link.';
                    statusEl.className = 'mt-2 text-center text-red-500';
                }
            } else if (e.target.id === 'notification-form') {
                e.preventDefault();
                const message = document.getElementById('notification-message').value;
                const statusEl = document.getElementById('notification-send-status');
                statusEl.textContent = 'Sending...';

                try {
                    await addDoc(collection(db, "broadcast_notifications"), {
                        message: message,
                        timestamp: Timestamp.now()
                    });
                    statusEl.textContent = 'Notification sent successfully!';
                    e.target.reset();
                    setTimeout(() => statusEl.textContent = '', 3000);
                } catch (error) {
                    console.error("Error sending notification:", error);
                    statusEl.textContent = 'Error sending notification.';
                    statusEl.className = 'text-red-500 mt-4 text-center font-semibold';
                }
            }
        });
        
        // --- User Notification System ---
        const notificationDropdown = document.getElementById('notification-dropdown');
        const notificationList = document.getElementById('notification-list');
        const notificationDot = document.getElementById('notification-dot');
        let broadcastNotifs = [];
        let directMessageNotifs = [];

        function renderAllNotifications() {
            const allNotifications = [...broadcastNotifs, ...directMessageNotifs];
            allNotifications.sort((a, b) => b.timestamp.toMillis() - a.timestamp.toMillis());
            
            notificationList.innerHTML = '';
            if (allNotifications.length === 0) {
                notificationList.innerHTML = '<p class="p-4 text-gray-500 text-sm">No notifications yet.</p>';
                return;
            }

            let hasUnseen = false;
            allNotifications.slice(0, 20).forEach(notif => {
                if (!notif.isSeen) hasUnseen = true;
                const icon = notif.type === 'direct' ? '&#128172;' : '&#128226;';
                const notifElement = document.createElement('div');
                notifElement.dataset.notifid = notif.id;
                notifElement.dataset.seen = notif.isSeen;
                notifElement.dataset.type = notif.type;
                notifElement.className = `p-4 border-b hover:bg-gray-100 ${notif.isSeen ? 'text-gray-500' : 'font-bold text-gray-800'}`;
                notifElement.innerHTML = `
                    <p class="text-sm">${icon} ${notif.message}</p>
                    <p class="text-xs text-gray-400 mt-1">${notif.timestamp.toDate().toLocaleString()}</p>
                `;
                notificationList.appendChild(notifElement);
            });
            notificationDot.classList.toggle('hidden', !hasUnseen);
        }

        document.getElementById('notification-bell').addEventListener('click', async () => {
            notificationDropdown.classList.toggle('hidden');
            if (notificationDropdown.classList.contains('hidden')) return;

            const user = auth.currentUser;
            if (!user) return;
            const userDocRef = doc(db, "users", user.uid);

            const unseenBroadcasts = broadcastNotifs.filter(n => !n.isSeen).map(n => n.id);
            if (unseenBroadcasts.length > 0) {
                const userDocSnap = await getDoc(userDocRef);
                const currentSeen = userDocSnap.data().seenNotifications || [];
                await updateDoc(userDocRef, { seenNotifications: [...new Set([...currentSeen, ...unseenBroadcasts])] });
            }

            const unseenDirects = directMessageNotifs.filter(n => !n.isSeen).map(n => n.id);
            const batch = writeBatch(db);
            unseenDirects.forEach(notifId => {
                const dmRef = doc(db, `users/${user.uid}/direct_messages`, notifId);
                batch.update(dmRef, { seen: true });
            });
            if (unseenDirects.length > 0) {
                await batch.commit();
            }
        });

        function listenForNotifications(userId) {
            const userDocRef = doc(db, "users", userId);

            const broadcastQuery = query(collection(db, "broadcast_notifications"), orderBy("timestamp", "desc"), limit(10));
            unsubscribeNotifications = onSnapshot(broadcastQuery, async (snapshot) => {
                const userDoc = await getDoc(userDocRef);
                const seenNotifications = userDoc.data().seenNotifications || [];
                broadcastNotifs = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data(),
                    isSeen: seenNotifications.includes(doc.id),
                    type: 'broadcast'
                }));
                renderAllNotifications();
            });

            const directMessageQuery = query(collection(db, `users/${userId}/direct_messages`), orderBy("timestamp", "desc"), limit(10));
            unsubscribeDirectMessages = onSnapshot(directMessageQuery, (snapshot) => {
                directMessageNotifs = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data(),
                    isSeen: doc.data().seen,
                    type: 'direct'
                }));
                renderAllNotifications();
            });
        }

    </script>
</body>
</html>
